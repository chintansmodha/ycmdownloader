<!DOCTYPE html>
<html lang="en">

<head style="font-family:arial;">
    <title>Production</title>
    {% load static %}
    <link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}" />
    <meta charset="utf-8" />
    <style>
        .one {
            display : inline-block;
            margin-left: 50px;
            margin-top: 10px;
        }

        .two {
            display : inline-block;
            margin-top: 10px;
        }
        .two input{
            margin-left: 50px;
        }
        .container {
            margin: 7px 48px auto;
            width: 65%;
            height: 300px;
            overflow: scroll;
        }

        table.gridtable {
            margin: 0 auto;
            width: 100%;
            overflow: auto;
            font-family: arial;
            font-size: 12px;
            color: #333333;
            border-width: 1px;
            border-color: #666666;
            border-collapse: collapse;
            text-align: center;
        }

        table.gridtable th {
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #666666;
            background-color: #b3b3cc;
        }

        table.gridtablefooter th {
            border-width: 2px;
            padding: 8px;
            border-style: solid;
            border-color: #666666;
            background-color: #F6B4A5;
        }

        .footer {
            border-width: 2px;
            width: 87%;
            padding: 8px;
            border-style: solid;
            border-color: #666666;
            background-color: #F6B4A5;
        }

        table.gridtable td {
            border-width: 1px;
            padding: 5px 0px;
            border-style: solid;
            border-color: #666666;
            font-weight: normal;
            text-align :left;
        }

        tr:hover {
            background-color: #D8DA5C
        }

        tbody tr:hover {
            opacity: 60%;
            background:black;
        }

        .containerfooter {
            margin: 10px auto;
            width: 88%;
            height: 50px;
            font-family: arial;
        }

        tr.processth  th{
            background: beige;
            text-align: right;
            padding: 5px 0px;
        }
        tr.processth  td{
            font-weight: bold;
        }
        tr.datarow td{
            text-align: right;
        }
        tr#sitebreakrow td, table#machineTable td{
            text-align: right;
        }
    </style>
    <STYLE>
        A {
            text-decoration: none;
        }
    </STYLE>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>


    <script>
<!--    Display upto max date only-->
    $(document).ready( function() {
    var now = new Date();

    var day = ("0" + now.getDate()).slice(-2);
    var month = ("0" + (now.getMonth() + 1)).slice(-2);

    var today = {{year}}+"-"+'{{month}}'+"-"+'{{day}}' ;


   $('#startdate').val(today);
   $('#startdate').attr('max', today);
   $('#startdates').val(today);
   $('#startdates').attr('max', today);
});

$(document).ready( function() {
    var product = {{product}}
    $('#Product').val(product);
});

<!--    toggle display grid acc/ to button-->
$(document).ready(function(){
    // Set div display to none
    $("#proccess").click(function(){
<!--        document.getElementById("proccess").checked = true;-->
        $('#form1').attr('action', 'ProccessWisefunctions');
    });

    // Set div display to block
    $("#itm").click(function(){
        $('#form1').attr('action', 'ItemMachinefunctions');
    });

    // Set div display to block
    $("#mach").click(function(){
        $('#form1').attr('action', 'MachineWisefunctions');
    });
});
$(window).on('popstate', function(event) {
    alert("pop");
});
</script>

</head>

<body style="background-color:lavender;font-family:arial;" onload="bodyFunction()">
<form action='ProccessWisefunction' id='form1' class="mar"  style="display: inline-block">
    <!-- date -->
    <div class="one ">
        <label for='startdate'><b>Date :</b></label>
        <input type='date' id='startdate' name='startdate' value="today" disabled>
        <label for='startdates' style="display:none;"><b>Date :</b></label>
        <input type='date' id='startdates' name='startdate' value="today" style="display:none">
    </div>
    <label for="Product"><b>&nbsp;&nbsp; Product Family :</b></label>
    <select name="Product" style="height: 25px; cursor: pointer;" id="Product" onchange="choice1(this)">
        <option value=0 style="display:none;"></option>
        <option value=1>POY Family</option>
        <option value=2>BCF Family</option>
        <option value=3>DTY Family</option>
    </select>
    <!-- radio -->
    <div class="two ">
        <input type='radio' id='proccess' name="select " value="pro" form='form1' class="mar" onchange="this.form.submit()" checked tabindex="1">
        <label for='proccess' >ProccessWise</label>
        <input type='radio' id='itm' name="select " value="it" form='form1' class="mar" onchange="this.form.submit()" tabindex="2">
        <label for='itm' >ItemWise</label>
        <input type='radio' id='mach' name="select " value="mac" form='form1' class="mar" onchange="this.form.submit()" tabindex="3">
        <label for='mach' >MachineWise</label>
    </div>
</form>
    <input type="text" id="myInput" onkeyup="searchFunction()" style="display: inline-block; margin-left:80px" title="Type process name" placeholder="search for process">

<!--    Process wise-->
<div id="processwise">
    <div style="width:100%;">
        <div style="width:81%;">
            <div style="display:flex; margin: 25px 48px auto; width:100%; height:30px; flex-direction: row-reverse; align-item:center;">
                <div style="border: 1px solid; width:26.2%; color:blue; text-align:center; border-color:grey; padding: 6px 0px; font-size: 12px; margin-right: 17px;">
                    <b>Production From {{fromdate}} - {{Date}}</b>
                </div>
                <div style="border: 1px solid; width:26%; margin-right:5px; color:blue; text-align:center; border-color:grey; padding: 6px 0px; font-size: 12px;">
                    <b>Production For {{Date}}</b>
                </div>
                <div style="align-self: flex-end; flex: auto; margin-right: 5px;font-size: small;color: blue; width: 0px;">
                    <strong style="color:black;">Details:</strong> <span id="Details"></span>
                </div>
            </div>
            <div class="container" style="height:200px; width:100%;">
                <table class="gridtable" id="myTable">
                    <thead style="height:1px;">
                    <tr>
                        <th style="width:150px;">Process</th>
                        <th style="width: 40px;">Today Production</th>
                        <th style="width: 40px;">Today II%</th>
                        <th style="width: 40px;">UpToDt Prodn</th>
                        <th style="width: 40px;">UpToDt II%</th>
                        <th style="width: 40px;">Average</th>
                        <th style="width: 40px;">Ist</th>
                        <th style="width: 40px;">Weft Use</th>
                        <th style="width: 40px;">P.Q.</th>
                        <th style="width: 40px;">SS.</th>
                        <th style="width: 40px;">Jl.</th>
                        <th style="width: 40px;">Ist</th>
                        <th style="width: 40px;">Weft Use</th>
                        <th style="width: 40px;">P.Q.</th>
                        <th style="width: 40px;">SS.</th>
                        <th style="width: 40px;">Jl.</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="processth">
                        <th style="text-align: left;">Totals</th>
                        <th>{{todaytotal}}</th>
                        <th>{{today11per}}</th>
                        <th>{{uptodatetotal}}</th>
                        <th>{{upto11per}}</th>
                        <th>{{totalAvg}}</th>
                        <th>{{today1st}}</th>
                        <th></th>
                        <th>{{today2nd}}</th>
                        <th></th>
                        <th></th>
                        <th>{{upto1st}}</th>
                        <th></th>
                        <th>{{upto2nd}}</th>
                        <th></th>
                        <th></th>
                    </tr>

                    {% for i in GDataProcessSummary %}
                    <tr class="datarow" onclick="myFunctions(this)">
                        <td style="text-align: left; background-color:lightblue;">{{i.PROCESSNAME}}</td>
                        <td style="background-color:lightgreen; ">{{i.TODAY_QTY}}</td>
                        <td style="background-color:lightblue; ">{{i.TODAY_IINDPERC}}</td>
                        <td style="background-color:pink; ">{{i.UPTODATE_QTY}}</td>
                        <td style="background-color:lightblue; ">{{i.UPTODATE_IINDPERC}}</td>
                        <td style="background-color:pink; ">{{i.average}}</td>
                        <td style="background-color:rgb(200, 241, 147); ">{{i.TODAY_1STQTY}}</td>
                        <td style="background-color:rgb(200, 241, 147); "></td>
                        <td style="background-color:lightblue; ">{{i.TODAY_PQQTY}}</td>
                        <td style="background-color:lightblue; "></td>
                        <td style="background-color:lightblue; "></td>
                        <td style="background-color:pink; ">{{i.UPTODATE_1STQTY}}</td>
                        <td style="background-color:pink; "></td>
                        <td style="background-color:lightblue; ">{{i.UPTODATE_PQQTY}}</td>
                        <td style="background-color:lightblue; "></td>
                        <td style="background-color:lightblue; "></td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

        <!-- second table-->
            <div class="container" style="height:150px; width:100%;">
                <table class="gridtable" id="siteTable">
                    <thead>
                    <tr>
                        <th style="width:150px;">Sites</th>
                        <th style="width: 40px;">Today Production</th>
                        <th style="width: 40px;">Today II%</th>
                        <th style="width: 40px;">UpToDt Prodn</th>
                        <th style="width: 40px;">UpToDt II%</th>
                        <th style="width: 40px;">Average</th>
                        <th style="width: 40px;">Ist</th>
                        <th style="width: 40px;">Weft Use</th>
                        <th style="width: 40px;">P.Q.</th>
                        <th style="width: 40px;">SS.</th>
                        <th style="width: 40px;">Jl.</th>
                        <th style="width: 40px;">Ist</th>
                        <th style="width: 40px;">Weft Use</th>
                        <th style="width: 40px;">P.Q.</th>
                        <th style="width: 40px;">SS.</th>
                        <th style="width: 40px;">Jl.</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="processth" >
                        <th style="text-align: left;">Totals</th>
                        <th>{{todaytotalsites}}</th>
                        <th>{{todaysite11per}}</th>
                        <th>{{uptoTotalsite}}</th>
                        <th>{{uptosite11per}}</th>
                        <th>{{totalsiteAvg}}</th>
                        <th>{{todaysite1st}}</th>
                        <th></th>
                        <th>{{todaytotal2nd}}</th>
                        <th></th>
                        <th></th>
                        <th>{{uptosite1st}}</th>
                        <th></th>
                        <th>{{uptosite2nd}}</th>
                        <th></th>
                        <th></th>
                    </tr>

                    {% for j in GDataSites %}
                    <tr  id="sitebreakrow" style="display:none;" onclick="mySiteFunctions(this)">
                        <td style="display: none;">{{j.PROCESSNAME}}</td>
                        <td style="text-align:left; background-color:lightblue;">{{j.SITES}}</td>
                        <td style="background-color:lightgreen; ">{{j.TODAY_QTY}}</td>
                        <td style="background-color:lightblue; ">{{j.TODAY_IINDPERC}}</td>
                        <td style="background-color:pink; ">{{j.UPTODATE_QTY}}</td>
                        <td style="background-color:lightblue; ">{{j.UPTODATE_IINDPERC}}</td>
                        <td style="background-color:pink; ">{{j.average}}</td>
                        <td style="background-color:rgb(200, 241, 147); ">{{j.TODAY_1STQTY}}</td>
                        <td style="background-color:rgb(200, 241, 147); "></td>
                        <td style="background-color:lightblue; ">{{j.TODAY_PQQTY}}</td>
                        <td style="background-color:lightblue; "></td>
                        <td style="background-color:lightblue; "></td>
                        <td style="background-color:pink; ">{{j.UPTODATE_1STQTY}}</td>
                        <td style="background-color:pink; "></td>
                        <td style="background-color:lightblue; ">{{j.UPTODATE_PQQTY}}</td>
                        <td style="background-color:lightblue; "></td>
                        <td style="background-color:lightblue; "></td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    <!-- third table-->
        <div style="width:95%;">
            `<div class="container" style="width:100%">
                <table class="gridtable" id="machineTable">
                    <thead>
                    <tr>
                        <th style="width:155px;">Machine</th>
                        <th style="width: 40px;">Today Production</th>
                        <th style="width: 40px;">Today II%</th>
                        <th style="width: 40px;">UpToDt Prodn</th>
                        <th style="width: 40px;">UpToDt II%</th>
                        <th style="width: 40px;">Average</th>
                        <th style="width: 40px;">Ist</th>
                        <th style="width: 40px;">Weft Use</th>
                        <th style="width: 40px;">P.Q.</th>
                        <th style="width: 40px;">SS.</th>
                        <th style="width: 40px;">Jl.</th>
                        <th style="width: 40px;">Ist</th>
                        <th style="width: 40px;">Weft Use</th>
                        <th style="width: 40px;">P.Q.</th>
                        <th style="width: 40px;">SS.</th>
                        <th style="width: 40px;">Jl.</th>
    <!--                    <th>High Prodn.</th>-->
                        <th style="width:170px;">Department</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="processth" style="background:beige;">
                        <td style="text-align: left;">Totals</td>
                        <td>{{todaytotalmachine}}</td>
                        <td>{{todaymachine11per}}</td>
                        <td>{{uptoTotalmachine}}</td>
                        <td>{{uptomachine11per}}</td>
                        <td>{{totalmachineAvg}}</td>
                        <td>{{todaymachine1st}}</td>
                        <td></td>
                        <td>{{todaytotalmach2nd}}</td>
                        <td></td>
                        <td></td>
                        <td>{{uptomachine1st}}</td>
                        <td></td>
                        <td>{{uptomachine2nd}}</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>

                    {% for k in GDataMachine %}
                    <tr id="machinebreak" style="display:none;">
                        <td style="display:none;">{{k.PROCESSNAME}}</td>
                        <td style="display:none;">{{k.SITES}}</td>
                        <td style="text-align:left; background-color:lightblue;">{{k.MACHINE}}</td>
                        <td style="background-color:lightgreen; ">{{k.TODAY_QTY}}</td>
                        <td style="background-color:lightblue; ">{{k.TODAY_IINDPERC}}</td>
                        <td style="background-color:pink; ">{{k.UPTODATE_QTY}}</td>
                        <td style="background-color:lightblue; ">{{k.UPTODATE_IINDPERC}}</td>
                        <td style="background-color:pink; ">{{k.average}}</td>
                        <td style="background-color:rgb(200, 241, 147); ">{{k.TODAY_1STQTY}}</td>
                        <td style="background-color:rgb(200, 241, 147); "></td>
                        <td style="background-color:lightblue; ">{{k.TODAY_PQQTY}}</td>
                        <td style="background-color:lightblue; "></td>
                        <td style="background-color:lightblue; "></td>
                        <td style="background-color:pink; ">{{k.UPTODATE_1STQTY}}</td>
                        <td style="background-color:pink; "></td>
                        <td style="background-color:lightblue; ">{{k.UPTODATE_PQQTY}}</td>
                        <td style="background-color:lightblue; "></td>
                        <td style="background-color:lightblue; "></td>
                        <td style="background-color:lightblue; text-align:left;">{{k.DEPARTMENT}}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>`
        </div>
    </div>
</div>


<script>
function searchFunction() {
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  table = document.getElementById("myTable");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[0];
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}

function bodyFunction(){
    document.getElementById("myTable").rows[2].cells[0].click();
}

function myFunctions(x){
    var y = x.rowIndex;
    var z = document.getElementById("siteTable").rows.length;
    var process = document.getElementById("myTable").rows[y].cells[0].innerHTML;
    var s = " " + process;
    document.getElementById("Details").innerHTML = s;
    var lenMaytab = document.getElementById("myTable").rows.length;
    var b = 2;
    while (b<lenMaytab){
        document.getElementById("myTable").rows[b].cells[0].style.backgroundColor="lightblue";
        document.getElementById("myTable").rows[b].cells[0].style.border = "1px solid #666666";
        b++;
    }
    document.getElementById("myTable").rows[y].cells[0].style.backgroundColor="yellow";
    document.getElementById("myTable").rows[y].cells[0].style.border = "1px solid black";
<!--    document.getElementById("siteTable").rows[2].cells[0].click();-->
    if(process == document.getElementById("siteTable").rows[y].cells[0].innerHTML){
            document.getElementById("siteTable").rows[y].cells[0].click();
        }
<!--    alert(process)-->
<!--    Totals************************-->
    totalItmPro = 0;
    totalUptoPro = 0;
    average = 0;
    today1st = 0;
    today2nd = 0;
    uptoDt1st = 0;
    uptoDt2nd = 0;
    var i = 2;
    while(i<=z){
        if(process == document.getElementById("siteTable").rows[i].cells[0].innerHTML){
            document.getElementById("siteTable").rows[i].style.display="revert";

            totalItmPro = totalItmPro + parseFloat(document.getElementById("siteTable").rows[i].cells[2].innerHTML);
            document.getElementById("siteTable").rows[1].cells[1].innerHTML = totalItmPro;

            totalUptoPro = totalUptoPro + parseFloat(document.getElementById("siteTable").rows[i].cells[4].innerHTML);
            document.getElementById("siteTable").rows[1].cells[3].innerHTML = totalUptoPro;

            average = parseFloat(totalUptoPro/{{day}});
            document.getElementById("siteTable").rows[1].cells[5].innerHTML = average.toFixed(0);

            today1st = today1st + parseFloat(document.getElementById("siteTable").rows[i].cells[7].innerHTML);
            document.getElementById("siteTable").rows[1].cells[6].innerHTML = today1st;

            today2nd = today2nd + parseFloat(document.getElementById("siteTable").rows[i].cells[9].innerHTML);
            document.getElementById("siteTable").rows[1].cells[8].innerHTML = today2nd;

            uptoDt1st = uptoDt1st + parseFloat(document.getElementById("siteTable").rows[i].cells[12].innerHTML);
            document.getElementById("siteTable").rows[1].cells[11].innerHTML = uptoDt1st;

            uptoDt2nd = uptoDt2nd + parseFloat(document.getElementById("siteTable").rows[i].cells[14].innerHTML);
            document.getElementById("siteTable").rows[1].cells[13].innerHTML = uptoDt2nd;

            if (totalItmPro !=0){
                today11per = Math.round((today2nd * 100)/totalItmPro)
                document.getElementById("siteTable").rows[1].cells[2].innerHTML = today11per.toFixed(2);
            }else{
                 document.getElementById("siteTable").rows[1].cells[2].innerHTML = totalItmPro.toFixed(2);
            }

            if (totalUptoPro !=0){
                UptoDt11per = Math.round((uptoDt2nd * 100)/totalUptoPro)
                document.getElementById("siteTable").rows[1].cells[4].innerHTML = UptoDt11per.toFixed(2);
            }else{
                 document.getElementById("siteTable").rows[1].cells[4].innerHTML = totalUptoPro.toFixed(2);
            }
        }else{
            document.getElementById("siteTable").rows[i].style.display = "none";
        }
        i = i + 1;
    }

}

function mySiteFunctions(x){
    var y = x.rowIndex;
    var z = document.getElementById("machineTable").rows.length;
    var process = document.getElementById("siteTable").rows[y].cells[0].innerHTML;
    var sites = document.getElementById("siteTable").rows[y].cells[1].innerHTML;
    var lenMaytab = document.getElementById("siteTable").rows.length;
    var b = 2;
    while (b<lenMaytab){
        document.getElementById("siteTable").rows[b].cells[1].style.backgroundColor="lightblue";
        document.getElementById("siteTable").rows[b].cells[1].style.border = "1px solid #666666";
        b++;
    }
    document.getElementById("siteTable").rows[y].cells[1].style.backgroundColor="yellow";
    document.getElementById("siteTable").rows[y].cells[1].style.border = "1px solid black";
<!--    alert(sites)-->
<!--    Total***********************************-->
    todaymach = 0;
    uptoDtmach = 0;
    average = 0;
    today1st = 0;
    today2nd = 0;
    uptoDt1st = 0;
    uptoDt2nd = 0;
    var i = 2;
    while(i<=z){
        if(process == document.getElementById("machineTable").rows[i].cells[0].innerHTML){
            if(sites == document.getElementById("machineTable").rows[i].cells[1].innerHTML){
                document.getElementById("machineTable").rows[i].style.display="revert";

                todaymach = todaymach + parseFloat(document.getElementById("machineTable").rows[i].cells[3].innerHTML);
                document.getElementById("machineTable").rows[1].cells[1].innerHTML = todaymach;

                uptoDtmach = uptoDtmach + parseFloat(document.getElementById("machineTable").rows[i].cells[5].innerHTML);
                document.getElementById("machineTable").rows[1].cells[3].innerHTML = uptoDtmach;

                average = parseFloat(uptoDtmach/{{day}});
                document.getElementById("machineTable").rows[1].cells[5].innerHTML = average.toFixed(0);

                today1st = today1st + parseFloat(document.getElementById("machineTable").rows[i].cells[8].innerHTML);
                document.getElementById("machineTable").rows[1].cells[6].innerHTML = today1st;

                today2nd = today2nd + parseFloat(document.getElementById("machineTable").rows[i].cells[10].innerHTML);
                document.getElementById("machineTable").rows[1].cells[8].innerHTML = today2nd;

                uptoDt1st = uptoDt1st + parseFloat(document.getElementById("machineTable").rows[i].cells[13].innerHTML);
                document.getElementById("machineTable").rows[1].cells[11].innerHTML = uptoDt1st;

                uptoDt2nd = uptoDt2nd + parseFloat(document.getElementById("machineTable").rows[i].cells[15].innerHTML);
                document.getElementById("machineTable").rows[1].cells[13].innerHTML = uptoDt2nd;

                if (todaymach !=0){
                    today11per = Math.round((today2nd * 100)/todaymach)
                    document.getElementById("machineTable").rows[1].cells[2].innerHTML = today11per.toFixed(2);
                }else{
                     document.getElementById("machineTable").rows[1].cells[2].innerHTML = todaymach.toFixed(2);
                }

                if (uptoDtmach !=0){
                    UptoDt11per = Math.round((uptoDt2nd * 100)/uptoDtmach)
                    document.getElementById("machineTable").rows[1].cells[4].innerHTML = UptoDt11per.toFixed(2);
                }else{
                     document.getElementById("machineTable").rows[1].cells[4].innerHTML = uptoDtmach.toFixed(2);
                }

            }else{
                document.getElementById("machineTable").rows[i].style.display = "none";
            }
        }else{
            document.getElementById("machineTable").rows[i].style.display = "none";
        }
        i = i + 1;
    }

}

function choice1(select) {
    var Product = " ";
    var startdates = " ";
     Product = "&Product=" +(select.options[select.selectedIndex].value);
     startdate += "&startdate=" +document.getElementById("startdate").value;
<!--     alert(product)-->
<!--     alert(startdates)-->
     window.open("ProccessWisefunctions?="+Product+startdate, "_self");
}

</script>


</body>

</html>